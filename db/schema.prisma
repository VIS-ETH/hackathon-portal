datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

enum role {
  ADMIN
  MENTOR
  HELPER
  PARTICIPANT
  GRADER
}

model user {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  // fields
  auth_id String
  name    String

  // related models
  sidequest_attempt sidequest_attempt[]
  team_member       team_member[]
  role_assignment   role_assignment[]
}

model role_assignment {
  user_id String @db.Uuid
  role    role

  // relations
  user user @relation(fields: [user_id], references: [id])

  // meta
  @@id([user_id, role])
}

model team {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  // fields
  name String

  // related models
  team_score         team_score[]
  team_member        team_member[]
  project_preference project_preference[]
  project_assignment project_assignment[]
}

model team_member {
  user_id String @db.Uuid
  team_id String @db.Uuid

  // relations
  user user @relation(fields: [user_id], references: [id])
  team team @relation(fields: [team_id], references: [id])

  // meta
  @@id([user_id, team_id])
}

model project {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  // fields
  title   String
  content String

  // related models
  project_preference project_preference[]
  project_assignment project_assignment[]
}

model project_preference {
  team_id    String @db.Uuid
  project_id String @db.Uuid

  // fields
  score Int

  // relations
  team    team    @relation(fields: [team_id], references: [id])
  project project @relation(fields: [project_id], references: [id])

  @@id([team_id, project_id])
}

model project_assignment {
  team_id    String @db.Uuid
  project_id String @db.Uuid

  //  relations
  team    team    @relation(fields: [team_id], references: [id])
  project project @relation(fields: [project_id], references: [id])

  // meta
  @@id([team_id, project_id])
}

model sidequest {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  // fields
  name        String
  description String
  accending   Boolean

  // related_models
  sidequest_attempt sidequest_attempt[]
}

model sidequest_attempt {
  id           String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sidequest_id String @db.Uuid
  user_id      String @db.Uuid

  // fields
  attempted_at DateTime
  result       Float

  // relations
  sidequest sidequest @relation(fields: [sidequest_id], references: [id])
  user      user      @relation(fields: [user_id], references: [id])
}

model team_score {
  id      String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  team_id String @db.Uuid

  // fields
  score    Int
  valid_at DateTime

  // relations
  team team @relation(fields: [team_id], references: [id])
}

model timeline_event {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  // fields
  title       String
  description String
  content     String
  start       DateTime
  end         DateTime
}
