enum Role {
  Admin
  Mentor
  Helper
  Grader
  Participant
}

model User {
  id       String   @id @default(uuid())
  authId   String
  name     String
  roleAssignment RoleAssignment?
  teamMembers   TeamMember[]
  sidequestAttempts SidequestAttempt[]
}

model Sidequest {
  id          String   @id @default(uuid())
  name        String
  description String
  accending   Boolean
  sidequestAttempts SidequestAttempt[]
}

model SidequestAttempt {
  id          String   @id @default(uuid())
  sidequest   Sidequest @relation(fields: [sidequestId], references: [id])
  sidequestId String
  user        User @relation(fields: [userId], references: [id])
  userId      String
  attemptedAt DateTime
  result      Int
}

model TeamScore {
  team      Team @relation(fields: [teamId], references: [id])
  teamId    String
  score     Int
  validAt   DateTime
  @@id([teamId, validAt])
}

model Team {
  id         String   @id @default(uuid())
  name       String
  members    TeamMember[]
  teamScores TeamScore[]
  preferences ProjectPreference[]
  assignments ProjectAssignment[]
}

model TeamMember {
  user   User @relation(fields: [userId], references: [id])
  userId String
  team   Team @relation(fields: [teamId], references: [id])
  teamId String
  @@id([userId, teamId])
}

model RoleAssignment {
  user   User @relation(fields: [userId], references: [id])
  userId String @unique
  role   Role
}

model Project {
  id          String   @id @default(uuid())
  title       String
  content     String
  preferences ProjectPreference[]
  assignments ProjectAssignment[]
}

model ProjectPreference {
  team    Team @relation(fields: [teamId], references: [id])
  teamId  String
  project Project @relation(fields: [projectId], references: [id])
  projectId String
  score   Int
  @@id([teamId, projectId])
}

model ProjectAssignment {
  team    Team @relation(fields: [teamId], references: [id])
  teamId  String
  project Project @relation(fields: [projectId], references: [id])
  projectId String
  @@id([teamId, projectId])
}

model TimelineEvent {
  id          String   @id @default(uuid())
  start       DateTime
  end         DateTime
  title       String
  description String
  content     String
}
